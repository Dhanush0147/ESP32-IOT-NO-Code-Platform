<!doctype html>
<html>
    <head>
        <title>Drag and Drop</title>
        <link rel="stylesheet" href="main.css" />
        <meta http-equiv="author" content="sai" />
    </head>
    <body>
        <div class="container">
            <div id="tools">
                <h3>Tools</h3>
                <button>
                    <a href="playground_esp32.html">Clear Playground</a>
                </button>
                <button>
                    <a href="esp32_user_control.html"
                        >Go Back to User Control</a
                    >
                </button>
                <div class="element" draggable="true">
                    <form action="esp32_control_backend.php" method="post">
                        <label for="gpio-digital-out"
                            >GPIO - Digital - output:
                        </label>
                        <select name="gpio-digital-out">
                            <option value="23">23</option>
                            <option value="22">22</option>
                            <option value="21">21</option>
                            <option value="19">19</option>
                            <option value="18">18</option>
                            <option value="5">5</option>
                        </select>
                        <input
                            type="radio"
                            name="gpio-digital-status"
                            value="1"
                        />
                        HIGH
                        <input
                            type="radio"
                            name="gpio-digital-status"
                            value="0"
                        />
                        LOW
                        <br />
                    </form>
                </div>
                <div class="element" draggable="true">
                    <form action="esp32_control_backend.php">
                        <label for="gpio-digital-in"
                            >GPIO - Digital input:
                        </label>
                        <select name="gpio-digital-in">
                            <option value="null">Null</option>
                            <option value="23">23</option>
                            <option value="22">22</option>
                            <option value="21">21</option>
                            <option value="19">19</option>
                            <option value="18">18</option>
                            <option value="5">5</option>
                        </select>
                        <select name="gpio-digital-in-status">
                            <option value="INPUT">INPUT</option>
                            <option value="INPUT_PULLUP">INPUT_PULLUP</option>
                            <option value="INPUT_PULLDOWN">
                                INPUT_PULLDOWN
                            </option></select
                        ><br />
                    </form>
                </div>
                <div class="element" draggable="true">
                    <form action="esp32_control_backend.php" method="post">
                        <label for="dac-write-pin"
                            >DAC Write(0-255 -> 0V-3.3V)</label
                        >
                        <select name="dac-write-pin">
                            <option value="25">25</option>
                            <option value="26">26</option>
                        </select>
                        <input
                            type="number"
                            name="dac-write-value"
                            max="255"
                            min="0"
                        />
                        <br />
                    </form>
                </div>
                <div class="element" draggable="true">
                    <form action="esp32_control_backend.php" method="post">
                        <label for="dac-disable-pin">DAC Disable</label>
                        <select name="dac-disable-pin">
                            <option value="25">25</option>
                            <option value="26">26</option>
                        </select>
                        <input
                            type="checkbox"
                            name="dac-disable-valid"
                            value="true"
                        />DISABLE
                        <br />
                    </form>
                </div>
                <div class="element" draggable="true">
                    <form action="esp32_control_backend.php" method="post">
                        <label for="delay-seconds"
                            >Delay (in milli seconds)</label
                        >
                        <input type="number" name="delay-seconds" min="0" />
                        <br />
                    </form>
                </div>
            </div>
            <div id="playground">
                <button id="submit-playground">Submit-Playground</button>
            </div>
        </div>

        <script>
            let elements = document.getElementsByClassName("element");
            let tools = document.getElementById("tools");
            let playground = document.getElementById("playground");
            let draggedForms = [];
            for (element of elements) {
                element.addEventListener("dragstart", function (e) {
                    let selected = e.target;
                    selected = selected.cloneNode(true);
                    selected.style.position = "absolute";
                    playground.addEventListener("dragover", function (e) {
                        e.preventDefault();
                    });
                    playground.addEventListener("drop", function (e) {
                        playground.appendChild(selected);
                        selected.style.position = "relative";
                        let form = selected.querySelector("form");
                        if (form) {
                            draggedForms.push(form);
                        }
                    });
                });
            }
            document
                .getElementById("submit-playground")
                .addEventListener("click", function (e) {
                    if (draggedForms.length === 0) {
                        alert("add atleast one element from the tool box,");
                        return;
                    }
                    function submitFormsSequentially(index) {
                        if (index < draggedForms.length) {
                            let form = draggedForms[index];
                            let responses = [];
                            let formData = new FormData(form);

                            fetch(form.action, {
                                method: "POST",
                                body: formData,
                            });

                            submitFormsSequentially(index + 1);
                        }
                    }
                    submitFormsSequentially(0);
                });
        </script>
    </body>
</html>
